<div class="p-4 sm:p-6 max-w-4xl mx-auto">
  <h1 class="text-2xl sm:text-3xl font-bold mb-6 text-center text-blue-800">Pagos</h1>

  <!-- Tabla de pagos -->
  <div *ngIf="cuotasPendientes?.length === 0" class="text-center text-gray-500">
    No hay pagos registrados.
  </div>

  <div *ngIf="cuotasPendientes && cuotasPendientes.length > 0" class="overflow-x-auto shadow-sm rounded-lg">
    <table class="min-w-full bg-white border border-gray-300">
      <thead class="bg-blue-50 text-gray-700">
        <tr>
          <th class="p-3 text-left">Fecha</th>
          <th class="p-3 text-left">Monto</th>
          <th class="p-3 text-left">Detalle</th>
          <th class="p-3 text-left">Estado</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let cuota of cuotasPendientes" class="border-t hover:bg-blue-50">
          <td class="p-3">{{ cuota.fechaPago ? (cuota.fechaPago | date:'dd/MM/yyyy') : '---' }}</td>
          <td class="p-3">Q {{ cuota.montoTotal }}</td>
          <td class="p-3">
            {{ cuota.detalles?.length > 0 ? cuota.detalles[0].descripcion : 'No aplica' }}
          </td>
          <td class="p-3">
            <span [ngClass]="{
              'text-green-600 font-semibold': cuota.estado === 'COMPLETADO',
              'text-red-600 font-semibold': cuota.estado === 'PENDIENTE'
            }">
              {{ cuota.estado }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Formulario -->
  <form [formGroup]="pagoForm" (ngSubmit)="abrirModal()" class="mt-8 bg-white p-6 rounded-lg shadow-md space-y-4">
    <label>
      <span class="block text-sm font-medium text-gray-700">Metros cúbicos de excedente</span>
      <input type="number" formControlName="metrosExceso"
             class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" />
    </label>

    <div class="bg-gray-50 p-4 rounded border text-sm">
      <p><strong>Monto base:</strong> Q {{ montoBase }}</p>
      <p><strong>Total a pagar:</strong> Q {{ totalPagar }}</p>
    </div>

    <button type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded">
      Realizar pago con tarjeta
    </button>
  </form>

  <!-- Modal -->
  <div *ngIf="showModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md mx-auto">
      <h2 class="text-xl font-bold mb-4 text-gray-800">Información de Pago</h2>

      <form [formGroup]="pagoForm" (ngSubmit)="pagar()" class="space-y-4">
        <!-- Número de tarjeta -->
        <div>
          <label class="block text-sm font-medium text-gray-700">Número de tarjeta</label>
          <input type="text" maxlength="16" formControlName="numeroTarjeta"
                 class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                 [class.border-red-500]="pagoForm.get('numeroTarjeta')?.invalid && pagoForm.get('numeroTarjeta')?.touched" />
          <small class="text-red-500" *ngIf="pagoForm.get('numeroTarjeta')?.invalid && pagoForm.get('numeroTarjeta')?.touched">
            Ingrese 16 dígitos válidos.
          </small>
        </div>

        <!-- CVV -->
        <div>
          <label class="block text-sm font-medium text-gray-700">CVV</label>
          <input type="text" maxlength="4" formControlName="cvv"
                 class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                 [class.border-red-500]="pagoForm.get('cvv')?.invalid && pagoForm.get('cvv')?.touched" />
          <small class="text-red-500" *ngIf="pagoForm.get('cvv')?.invalid && pagoForm.get('cvv')?.touched">
            Ingrese 3 o 4 dígitos válidos.
          </small>
        </div>

        <!-- Fecha vencimiento -->
        <div>
          <label class="block text-sm font-medium text-gray-700">Fecha vencimiento (MM/YY)</label>
          <input type="text" placeholder="MM/YY" formControlName="vencimiento"
                 class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                 [class.border-red-500]="pagoForm.get('vencimiento')?.invalid && pagoForm.get('vencimiento')?.touched" />
          <small class="text-red-500" *ngIf="pagoForm.get('vencimiento')?.invalid && pagoForm.get('vencimiento')?.touched">
            Formato inválido. Usa MM/YY.
          </small>
        </div>

        <!-- Total -->
        <div class="text-sm bg-gray-50 p-3 rounded border">
          <p><strong>Total a pagar:</strong> Q {{ totalPagar }}</p>
        </div>

        <!-- Acciones -->
        <div class="flex justify-end gap-4">
          <button type="button" (click)="showModal = false"
                  class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">
            Cancelar
          </button>
          <button type="submit"
                  class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
                  [disabled]="pagoForm.invalid">
            Confirmar Pago
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
